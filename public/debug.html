<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Graphitube</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card h2 {
            margin-bottom: 15px;
            color: #fbbf24;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .label {
            font-weight: bold;
            color: #93c5fd;
        }
        .value {
            color: #d1fae5;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .status.success { background: #10b981; color: white; }
        .status.error { background: #ef4444; color: white; }
        .status.warning { background: #f59e0b; color: white; }
        
        .test-section {
            margin-top: 20px;
        }
        .test-item {
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-right: 4px solid transparent;
        }
        .test-item.pass { border-right-color: #10b981; }
        .test-item.fail { border-right-color: #ef4444; }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2563eb;
        }
        
        #console-output {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            direction: ltr;
            text-align: left;
        }
        
        .copy-btn {
            background: #8b5cf6;
            float: left;
        }
        .copy-btn:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Graphitube - Debug Panel</h1>
        
        <!-- Current Status -->
        <div class="card">
            <h2>ğŸ“ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            <div class="info-row">
                <span class="label">Full URL:</span>
                <span class="value" id="full-url"></span>
            </div>
            <div class="info-row">
                <span class="label">Expected URL:</span>
                <span class="value">https://mahmoudchouaibi5-glitch.github.io/Graphitube/</span>
            </div>
            <div class="info-row">
                <span class="label">Pathname:</span>
                <span class="value" id="pathname"></span>
            </div>
            <div class="info-row">
                <span class="label">Base Path:</span>
                <span class="value">/Graphitube/</span>
            </div>
            <div class="info-row">
                <span class="label">Status:</span>
                <span class="status" id="url-status">Checking...</span>
            </div>
        </div>
        
        <!-- File Tests -->
        <div class="card">
            <h2>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
            <div class="test-section" id="file-tests">
                <div class="test-item">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>
            </div>
        </div>
        
        <!-- Asset Tests -->
        <div class="card">
            <h2>ğŸ¨ Ø§Ø®ØªØ¨Ø§Ø± Assets</h2>
            <div class="test-section" id="asset-tests">
                <div class="test-item">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>
            </div>
        </div>
        
        <!-- Service Worker -->
        <div class="card">
            <h2>âš™ï¸ Service Worker</h2>
            <div class="info-row">
                <span class="label">Support:</span>
                <span class="value" id="sw-support"></span>
            </div>
            <div class="info-row">
                <span class="label">Registrations:</span>
                <span class="value" id="sw-registrations"></span>
            </div>
            <button onclick="clearServiceWorkers()">ğŸ—‘ï¸ Ù…Ø³Ø­ Service Workers</button>
            <button onclick="clearCache()">ğŸ—‘ï¸ Ù…Ø³Ø­ Cache</button>
        </div>
        
        <!-- Actions -->
        <div class="card">
            <h2>ğŸ› ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h2>
            <button onclick="runAllTests()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
            <button onclick="testMainApp()">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± App Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
            <button onclick="hardReload()">â™»ï¸ Hard Reload</button>
            <button class="copy-btn" onclick="copyReport()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
        
        <!-- Console Output -->
        <div class="card">
            <h2>ğŸ’» Console Output</h2>
            <div id="console-output"></div>
        </div>
    </div>
    
    <script>
        let consoleLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-MA');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            const line = `[${timestamp}] ${prefix} ${message}`;
            consoleLog.push(line);
            
            const output = document.getElementById('console-output');
            output.innerHTML = consoleLog.join('\n');
            output.scrollTop = output.scrollHeight;
            
            console.log(line);
        }
        
        // Display current URL info
        function displayURLInfo() {
            document.getElementById('full-url').textContent = window.location.href;
            document.getElementById('pathname').textContent = window.location.pathname;
            
            const expectedPath = '/Graphitube/';
            const isCorrect = window.location.pathname.startsWith(expectedPath);
            
            const statusEl = document.getElementById('url-status');
            if (isCorrect) {
                statusEl.textContent = 'ØµØ­ÙŠØ­ âœ…';
                statusEl.className = 'status success';
                log('URL path ØµØ­ÙŠØ­', 'success');
            } else {
                statusEl.textContent = 'Ø®Ø§Ø·Ø¦ âŒ';
                statusEl.className = 'status error';
                log('URL path ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
            }
        }
        
        // Test if file exists
        async function testFile(url, name) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                const exists = response.ok;
                log(`${name}: ${exists ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'} (${response.status})`, exists ? 'success' : 'error');
                return { name, exists, status: response.status };
            } catch (error) {
                log(`${name}: Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ - ${error.message}`, 'error');
                return { name, exists: false, error: error.message };
            }
        }
        
        // Run file tests
        async function runFileTests() {
            const basePath = '/Graphitube/';
            const tests = [
                { url: `${basePath}`, name: 'index.html (root)' },
                { url: `${basePath}index.html`, name: 'index.html (explicit)' },
                { url: `${basePath}manifest.webmanifest`, name: 'manifest.webmanifest' },
                { url: `${basePath}404.html`, name: '404.html' },
                { url: `${basePath}test-page.html`, name: 'test-page.html' },
            ];
            
            const results = [];
            for (const test of tests) {
                results.push(await testFile(test.url, test.name));
            }
            
            // Display results
            const container = document.getElementById('file-tests');
            container.innerHTML = results.map(r => `
                <div class="test-item ${r.exists ? 'pass' : 'fail'}">
                    ${r.exists ? 'âœ…' : 'âŒ'} ${r.name} 
                    ${r.status ? `(${r.status})` : ''}
                    ${r.error ? `<br><small>${r.error}</small>` : ''}
                </div>
            `).join('');
            
            return results;
        }
        
        // Test assets
        async function runAssetTests() {
            const basePath = '/Graphitube/';
            const tests = [
                { url: `${basePath}icon-192.png`, name: 'icon-192.png' },
                { url: `${basePath}icon-512.png`, name: 'icon-512.png' },
                { url: `${basePath}icon.svg`, name: 'icon.svg' },
            ];
            
            const results = [];
            for (const test of tests) {
                results.push(await testFile(test.url, test.name));
            }
            
            // Display results
            const container = document.getElementById('asset-tests');
            container.innerHTML = results.map(r => `
                <div class="test-item ${r.exists ? 'pass' : 'fail'}">
                    ${r.exists ? 'âœ…' : 'âŒ'} ${r.name}
                    ${r.status ? `(${r.status})` : ''}
                </div>
            `).join('');
            
            return results;
        }
        
        // Check Service Workers
        async function checkServiceWorkers() {
            if ('serviceWorker' in navigator) {
                document.getElementById('sw-support').textContent = 'âœ… Ù…Ø¯Ø¹ÙˆÙ…';
                
                const registrations = await navigator.serviceWorker.getRegistrations();
                document.getElementById('sw-registrations').textContent = 
                    registrations.length > 0 
                    ? `${registrations.length} Ù…Ø³Ø¬Ù„` 
                    : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                log(`Service Workers: ${registrations.length}`, registrations.length > 0 ? 'info' : 'success');
                
                registrations.forEach((reg, i) => {
                    log(`  SW ${i + 1}: ${reg.active ? 'active' : 'inactive'} - ${reg.scope}`);
                });
            } else {
                document.getElementById('sw-support').textContent = 'âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
                log('Service Worker ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­', 'error');
            }
        }
        
        // Clear Service Workers
        async function clearServiceWorkers() {
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const reg of registrations) {
                    await reg.unregister();
                    log('ØªÙ… Ù…Ø³Ø­ Service Worker', 'success');
                }
                await checkServiceWorkers();
            }
        }
        
        // Clear Cache
        async function clearCache() {
            if ('caches' in window) {
                const names = await caches.keys();
                for (const name of names) {
                    await caches.delete(name);
                    log(`ØªÙ… Ù…Ø³Ø­ Cache: ${name}`, 'success');
                }
                log(`ØªÙ… Ù…Ø³Ø­ ${names.length} cache`, 'success');
            }
        }
        
        // Test main app
        async function testMainApp() {
            log('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ...');
            
            const result = await testFile('/Graphitube/', 'Main App');
            
            if (result.exists) {
                log('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...', 'success');
                setTimeout(() => {
                    window.location.href = '/Graphitube/';
                }, 1000);
            } else {
                log('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!', 'error');
                log('ØªØ­Ù‚Ù‚ Ù…Ù† GitHub Actions', 'error');
            }
        }
        
        // Hard reload
        function hardReload() {
            log('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„...');
            location.reload(true);
        }
        
        // Run all tests
        async function runAllTests() {
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            
            displayURLInfo();
            await checkServiceWorkers();
            await runFileTests();
            await runAssetTests();
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        }
        
        // Copy report
        function copyReport() {
            const report = consoleLog.join('\n');
            navigator.clipboard.writeText(report).then(() => {
                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
            });
        }
        
        // Run on load
        window.addEventListener('DOMContentLoaded', () => {
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('ğŸš€ Graphitube Debug Panel Loaded');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            runAllTests();
        });
    </script>
</body>
</html>
